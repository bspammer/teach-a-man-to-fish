<html>
    <head>
        <link rel="stylesheet" href="/css/home.css">
    </head>
    <body>
        <div id="content">
            <h1 id="heading">COOK YOU LAZY BASTARD</h1>
            <ul>
                {% for recipe in recipes %}
                <li class="recipe-item" data-recipeid="{{ recipe['recipe_id'] }}" data-title="{{ recipe['nice_title'] }}">
                    <a class="nounderline" href="#">
                        <img class="recipe-img" src="{{ recipe['img_url'] }}" />
                    </a>
                </li>
                {% endfor %}
            </ul>
            <div id="recipe-title-display"></div>
            <script>
            function get(url) {
                return new Promise(function(resolve, reject) {
                    var req = new XMLHttpRequest();
                    req.open('GET', url);
                    req.onload = function() {
                        if (req.status == 200) {
                            resolve(req.response);
                        }
                        else {
                            reject(Error(req.statusText));
                        }
                    };
                    req.onerror = function() {
                        reject(Error("Network Error"));
                    };
                    req.send();
                });
            }
            recipeItems = document.getElementsByClassName("recipe-item");
            titleDisplay = document.getElementById("recipe-title-display");
            for (var i=0; i < recipeItems.length; i++) {
                item = recipeItems[i];
                item.addEventListener("click", bindClick(item));
                item.addEventListener("mouseover", bindHover(item.dataset.title));
            }
            function bindClick(item) {
                return function() {
                    var checkmark = document.createElement("img");
                    checkmark.src = "/img/check.png";
                    checkmark.classList.add("checkmark");
                    item.appendChild(checkmark);

                    var id = item.dataset.recipeid;
                    get("/add?recipeid=" + id).then(function(response) {
                        console.log("Yay!", response);
                    }, function(error) {
                        console.log("Awww...", error);
                    })
                    item.firstElementChild.firstElementChild.classList.add("selected");
                };
            }
            function bindHover(title) {
                return function() {
                    titleDisplay.textContent = title;
                    titleDisplay.style.display = "block";
                }
            }
            </script>
        </div>
    </body>
</html>
